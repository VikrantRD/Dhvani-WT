<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Dhvani-WT</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,140,0,0.03) 35px, rgba(255,140,0,0.03) 70px),
                radial-gradient(circle at 20% 50%, rgba(255,165,0,0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container { max-width: 500px; width: 100%; position: relative; z-index: 1; }
        
        .screen {
            background: #fff;
            color: #000;
            border-radius: 30px;
            min-height: 600px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.9);
            position: relative;
            overflow: hidden;
        }
        
        .status-bar {
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .content { padding: 0 24px 30px; }
        
        .hero { text-align: center; padding: 60px 0 50px; }
        
        .app-name {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: 3px;
        }
        
        .app-subtitle {
            font-size: 13px;
            color: #666;
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .btn {
            width: 100%;
            height: 64px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .btn-primary { background: #000; color: #fff; }
        .btn-secondary { background: #f5f5f5; color: #000; }
        
        .divider {
            text-align: center;
            margin: 24px 0;
            color: #999;
            font-size: 14px;
            position: relative;
        }
        
        .divider::before, .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 42%;
            height: 1px;
            background: #e0e0e0;
        }
        
        .divider::before { left: 0; }
        .divider::after { right: 0; }
        
        .input {
            width: 100%;
            height: 70px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 32px;
            text-align: center;
            font-family: monospace;
            letter-spacing: 8px;
            font-weight: 700;
            margin-bottom: 16px;
            text-transform: uppercase;
        }
        
        .card {
            background: #000;
            color: #fff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .status-live {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: #00d66b;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            background: #00d66b;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .big-num {
            font-size: 60px;
            font-weight: 700;
            line-height: 1;
            margin: 12px 0;
        }
        
        .sub { font-size: 15px; color: #999; }
        
        .mode-toggle {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 4px;
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            height: 44px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
        }
        
        .mode-btn.active { background: #000; color: #fff; }
        
        .hidden { display: none !important; }
        
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            color: #ef4444;
            font-size: 14px;
        }
        
        .code-display {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .code {
            font-size: 48px;
            font-family: monospace;
            letter-spacing: 12px;
            font-weight: 700;
            color: #000;
        }
        
        .note { text-align: center; font-size: 12px; color: #999; margin-top: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="screen">
            <div class="status-bar">
                <span id="time">9:41</span>
                <span>‚óè‚óè‚óè‚óè</span>
            </div>
            
            <div class="content">
                <div id="setupScreen">
                    <div class="hero">
                        <div class="app-name">DHVANI-WT</div>
                        <div class="app-subtitle">Always-On Voice</div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="startHost()">
                        <span style="font-size: 24px;">üìç</span>
                        <span>Host</span>
                    </button>
                    
                    <div class="divider">or</div>
                    
                    <input type="text" id="joinCode" class="input" placeholder="A1234" maxlength="5">
                    
                    <button class="btn btn-secondary" onclick="startJoin()">
                        <span style="font-size: 24px;">üîó</span>
                        <span>Join</span>
                    </button>
                    
                    <div id="error" class="error hidden"></div>
                </div>
                
                <div id="codeScreen" class="hidden">
                    <div class="code-display">
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;">üîê YOUR CODE</div>
                        <div class="code" id="sessionCode">B4729</div>
                        <div class="note">Share this with your partner</div>
                    </div>
                </div>
                
                <div id="dashboard" class="hidden">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 13px; color: #999;">BATTERY</span>
                            <div class="status-live">
                                <span class="dot"></span>
                                <span>LIVE</span>
                            </div>
                        </div>
                        <div class="big-num" id="battery">85%</div>
                        <div class="sub" id="batteryTime">Calculating...</div>
                    </div>
                    
                    <div class="mode-toggle">
                        <button class="mode-btn active" id="basicBtn" onclick="switchMode('basic')">‚ö° Basic</button>
                        <button class="mode-btn" id="proBtn" onclick="switchMode('pro')">üöÄ Pro</button>
                    </div>
                    
                    <button class="btn btn-primary" id="muteBtn" onclick="toggleMute()">
                        üé§ Mute
                    </button>
                    
                    <button class="btn btn-secondary" onclick="endSession()">
                        End Session
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let state = {
            connected: false,
            muted: false,
            mode: 'basic',
            code: null,
            peer: null,
            call: null,
            stream: null,
            battery: 85
        };
        
        function updateTime() {
            const now = new Date();
            document.getElementById('time').textContent = 
                now.getHours().toString().padStart(2, '0') + ':' + 
                now.getMinutes().toString().padStart(2, '0');
        }
        
        setInterval(updateTime, 60000);
        updateTime();
        
        function generateCode() {
            const letter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
            const digits = Math.floor(1000 + Math.random() * 9000);
            return letter + digits;
        }
        
        async function startHost() {
            try {
                hideError();
                state.code = generateCode();
                document.getElementById('sessionCode').textContent = state.code;
                showScreen('codeScreen');
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                state.stream = stream;
                
                state.peer = new Peer(state.code + '-host');
                
                state.peer.on('call', call => {
                    call.answer(stream);
                    call.on('stream', remoteStream => {
                        playAudio(remoteStream);
                        showDashboard();
                    });
                    state.call = call;
                });
                
                setTimeout(() => {
                    document.getElementById('codeScreen').classList.add('hidden');
                    showDashboard();
                }, 5000);
                
            } catch (error) {
                showError('Failed: ' + error.message);
            }
        }
        
        async function startJoin() {
            try {
                hideError();
                const code = document.getElementById('joinCode').value.trim().toUpperCase();
                
                if (!code.match(/^[A-Z]\d{4}$/)) {
                    showError('Invalid code format');
                    return;
                }
                
                state.code = code;
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                state.stream = stream;
                
                state.peer = new Peer(code + '-join');
                
                state.peer.on('open', () => {
                    const call = state.peer.call(code + '-host', stream);
                    call.on('stream', remoteStream => {
                        playAudio(remoteStream);
                        showDashboard();
                    });
                    state.call = call;
                });
                
            } catch (error) {
                showError('Failed: ' + error.message);
            }
        }
        
        function playAudio(stream) {
            const audio = new Audio();
            audio.srcObject = stream;
            audio.autoplay = true;
            audio.play();
            state.connected = true;
        }
        
        function switchMode(mode) {
            state.mode = mode;
            document.getElementById('basicBtn').classList.toggle('active', mode === 'basic');
            document.getElementById('proBtn').classList.toggle('active', mode === 'pro');
            updateBattery();
        }
        
        function toggleMute() {
            state.muted = !state.muted;
            if (state.stream) {
                state.stream.getAudioTracks()[0].enabled = !state.muted;
            }
            document.getElementById('muteBtn').textContent = state.muted ? 'üîá Unmute' : 'üé§ Mute';
            document.getElementById('muteBtn').style.background = state.muted ? '#ef4444' : '#000';
        }
        
        function updateBattery() {
            const rate = state.mode === 'pro' ? 12 : 20;
            const hours = Math.floor(state.battery / rate);
            const mins = Math.round((state.battery / rate - hours) * 60);
            document.getElementById('battery').textContent = state.battery + '%';
            document.getElementById('batteryTime').textContent = hours + 'h ' + mins + 'm remaining';
        }
        
        function showDashboard() {
            showScreen('dashboard');
            updateBattery();
            
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    state.battery = Math.round(battery.level * 100);
                    updateBattery();
                    battery.addEventListener('levelchange', () => {
                        state.battery = Math.round(battery.level * 100);
                        updateBattery();
                    });
                });
            }
        }
        
        function endSession() {
            if (confirm('End session?')) {
                if (state.stream) state.stream.getTracks().forEach(t => t.stop());
                if (state.call) state.call.close();
                if (state.peer) state.peer.destroy();
                state = { connected: false, muted: false, mode: 'basic', code: null, battery: 85 };
                showScreen('setupScreen');
                document.getElementById('joinCode').value = '';
            }
        }
        
        function showScreen(id) {
            ['setupScreen', 'codeScreen', 'dashboard'].forEach(s => 
                document.getElementById(s).classList.add('hidden')
            );
            document.getElementById(id).classList.remove('hidden');
        }
        
        function showError(msg) {
            document.getElementById('error').textContent = msg;
            document.getElementById('error').classList.remove('hidden');
        }
        
        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }
        
        window.addEventListener('beforeunload', e => {
            if (state.connected) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
